
<script>
	function showEmailForm(email) {
		// document.getElementById("email-form").style.
		console.log('params email', email);
		$("#student-email").val(email);
		$("#email-form").css({'opacity' : 1, 'z-index':1});
	}
	
	function hideEmailForm() {
		console.log('student email', $("#student-email").val());
		
		$("#email-form").css({'opacity' : 0, 'z-index':0});
	}
</script>

<form id="email-form" action="" method="" 
style="
opacity: 0;
position: absolute;
top: 0;
left: 0;
width: 100vw;
height: 100vh;
background: #00000040;
z-index: 0;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
transition: opacity .1s linear;
">
<div style="
	display: flex;
    flex-direction: column;
    width: 50%;
    "
>
	<h1 style="
	    background: white;
    font-size: 16px;
    text-transform: uppercase;
    letter-spacing: 3px;
    padding: 3px 30px;
	">Email Body</h1>
	<input id="student-email" type="hidden" value="">
	<input type="textarea" style="
    height: 200px;
	">
	<input class="btn btn-primary" type="submit" value="send" onclick="hideEmailForm()" style="
	margin-top: 10px;
	">
</div>
</form>

<div class="container-fluid">
    <div class="row">
        <div class="col-12 col-md-8 offset-md-2 col-lg-6 offset-lg-3">
            <% if notice %>
                <%= render "notice_danger" %>
            <% end %>
        </div>
        <div class="col-12 col-md-8 offset-md-2 col-lg-6 offset-lg-3">
            <h1 class="text-center">Students on the Queue</h1>
        </div>
        <div class="col-12 col-md-8 offset-md-2 col-lg-6 offset-lg-3">
            <div class="card">
                <div class="card-header">
                    <nav>
                        <div class="nav nav-tabs card-header-tabs mx-auto text-center" id="nav-tab" role="tablist">
                            <% @true_classes.each_with_index do |true_class, index| %>
                                <a class="nav-item nav-link<% if (index == 0) %> active<% end %>" 
                                    id="<%=true_class %>-tab"
                                    data-toggle="tab" 
                                    href="#<%=true_class %>" 
                                    role="tab" 
                                    aria-controls="#<%=true_class %>" 
                                    aria-selected="<% if (index == 0) %>true<% else %>false<%end%>">
                                    <%=true_class %>
                                </a>
                            <% end %>
                        </div>
                    </nav>
                </div>
                    <div class="card-body">
                        <div class="tab-content" id="nav-tabContent">
                            <% @true_classes.each_with_index do |true_class, index| %>
                                <div class="tab-pane fade<% if (index == 0) %> show active<%end%>"
                                    id="<%=true_class %>" 
                                    role="tabpanel" 
                                    aria-labelledby="<%=true_class %>-tab">
                                    <% course_obj = Course.where(true_class == :name).first %>
                                    <% requests_obj = Request.where(course_obj.id == :course_id).order(created_at: :asc) %>
                                        <% if (requests_obj.length == 0) %>
                                            <div class="alert alert-info">
                                                <p> There are no students in the queue for <%=true_class%>.
                                            </div>
                                        <% else %>
                                            <% requests_obj.each do |req| %>
                                                <% tutee = Tutee.find(req.tutee_id) %> 
                                                <!-- TODO: use joins for efficiency, reduce db roundtrips -->
                                                <ul class="list-group list-group-flush">
                                                    <li class="list-group-item <%if tutee.privilege != 'No'%> background-success<% end %>">
                                                        <p> <%= tutee.first_name + ' ' + tutee.last_name%> </p>
                                                        <p> <%= req.subject%> </p>
                                                        <p> <button class="btn btn-primary" onclick="showEmailForm('<%= tutee.email %>')">Email</button> </p>         
                                                    </li>
                                                </ul>
                                            </div>
                                    <% end%>
                            <% end %>
                        </div>
                    </div>
                <% end %>
            </div>
        </div>
    </div>
</div>

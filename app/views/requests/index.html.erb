<%= stylesheet_link_tag "tutors_index" %>

<% if notice %>
  <%= render "notice_danger" %>
<% end %>

<h1 style="padding-bottom: 10px;">Students</h1>
<script>
  function showEmailForm(meta) {
    const email = meta[0]
    const sid = meta[1]
    const requestid = meta[2]
    // console.log(meta)
    console.log('passed in:   ', sid, requestid);

    $("#student-id").val(sid);
    $("#student-email").val(email);
    $("#request-id").val(requestid);


    // const email = Tutee.find(id).email
    $("#to-email").html("To: " + email );
    $("#email-form").css({'opacity' : 1, 'z-index':1});
  }
  
  function hideEmailForm() {
    console.log('in hidden form: ', $("#student-id").val());
        console.log('in hidden form: ', $("#tutor-id").val());

    $("#email-form").css({'opacity' : 0, 'z-index':0});
  }
</script>

<form id="email-form" action=<%=requests_email_tutor_path(@tutor) %> method="get" 
style="
opacity: 0;
position: absolute;
top: 0;
left: 0;
width: 100vw;
height: 100vh;
background: #00000040;
z-index: 0;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
transition: opacity .1s linear;
">
<div style="
  display: flex;
    flex-direction: column;
    width: 50%;
    "
>
  <h1 style="
      background: white;
    font-size: 16px;
    text-transform: uppercase;
    letter-spacing: 3px;
    display: flex;
    justify-content: space-between;
    padding: 3px 3px 3px 10px;
  ">
  <div> Email Body</div>
  <button type="button" class="close" aria-label="Close" style="
      height: fit-content;
    line-height: 13.5px;" onclick="hideEmailForm()">
    <span aria-hidden="true">&times;</span>
  </button>
  </h1>
  <h1 id="to-email" style="
      background: white;
    font-size: 16px;
    text-transform: uppercase;
    letter-spacing: 3px;
    display: flex;
    justify-content: space-between;
    padding: 3px 3px 3px 10px;
  "></h1>

  <input id="student-id" name="student[id]" type="hidden" value="">
  <input id="student-email" name="student[email]" type="hidden" value="">
  <input id="request-id" name="student[requestid]" type="hidden" value="">

  <textarea name="tutor[text_area]" style="
    height: 200px;
  "> </textarea>
  <input class="btn btn-primary" type="submit" value="send" onclick="hideEmailForm()" style="
  margin-top: 10px;
  ">
</div>
</form>


<body>
  <div id="main">
    <% if flash[:notice] %>
      <div class="message" id="notice">
        <%= flash[:notice] %>
      </div>
      <%= yield %>
    <% end %>
  </div>
</body>
<table class="table-striped col-md-10">
  <thead>
    <tr>
      <th>Tutee id</th>
      <th>Course id</th>
      <th>Subject</th>
      <th>created date</th>
    </tr>
  </thead>
  <tbody>
    <% @requests.each do |request| %>
      <tr>
        <td>
          <%= request.tutee_id %>
        </td>
        <td>
          <%= request.course_id %>
        </td>
        <td>
          <%= request.subject %>
        </td>
        <td>
          <%= request.created_at %>
        </td>

        <td>
          <button onclick="showEmailForm(['<%=Tutee.find(request.tutee_id).email%>', '<%=request.tutee_id%>', '<%=request.id %>' ])">Email</button>
        </td>

      </tr>
    <% end %>
  </tbody>
</table>
